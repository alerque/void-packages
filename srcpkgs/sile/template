# Template file for 'sile'
pkgname=sile
version=0.10.9
revision=1
build_style=gnu-configure
configure_args="--with-system-luarocks"
hostmakedepends="pkg-config"
makedepends="fontconfig-devel harfbuzz-devel icu-devel lua54 lua54-cassowary
	lua54-cosmo lua54-linenoise lua54-lpeg lua54-zlib lua54-cliargs
	lua54-luaepnf lua54-luaexpat lua54-luafilesystem lua54-repl lua54-luasec
	lua54-luasocket lua54-penlight lua54-stdlib lua54-vstruct"
depends="fonts-sil-gentium libtexpdf lua54 lua54-cassowary lua54-cosmo
	lua54-linenoise lua54-lpeg lua54-zlib lua54-cliargs lua54-luaepnf
	lua54-luaexpat lua54-luafilesystem lua54-repl lua54-luasec lua54-luasocket
	lua54-penlight lua54-stdlib lua54-vstruct"
checkdepends="poppler"
short_desc="Modern typesetting system inspired by TeX"
maintainer="John <me@johnnynator.dev>"
license="MIT"
homepage="https://www.sile-typesetter.org"
distfiles="https://github.com/sile-typesetter/sile/releases/download/v${version}/sile-${version}.tar.bz2"
checksum=44eaaf286b059b46eb51f28ef813d149538b06f4541c1eb7fb6faef26d60a564

if [ "$CROSS_BUILD" ]; then
	hostmakedepends+=" lua54 lua54-lpeg lua54-luaexpat lua54-zlib
		lua54-luafilesystem lua54-luasocket lua54-luasec"
fi

post_install() {
	vlicense LICENSE
}

libtexpdf_package() {
	short_desc="PDF library extracted from TeX's dvipdfmx"
	pkg_install() {
		vmove "usr/lib/libtexpdf.so.*"
	}
}

libtexpdf-devel_package() {
	short_desc="PDF library extracted from TeX's dvipdfmx - (development files)"
	depends="libtexpdf-${version}_${revision}"
	pkg_install() {
		vmove usr/include
		vmove "usr/lib/*.so"
	}
}
